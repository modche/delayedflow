<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find breakpoints in DFI curve — find_bps • delayedflow</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Find breakpoints in DFI curve — find_bps" />
<meta property="og:description" content="Estimates n breakpoints in the DFI curve.
DFI values are compared against n+1 piecewise linear segments and the minimization of the
residuals (between linear segments and DFI curve). Several parameters can be customized.
If q_obs is given in daily temporal resolution then also n can be interpreted as delay in days
for different contributions (default)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">delayedflow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.20</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tidy_streamflow_contr.html">02 - Delayedflow Analysis in R tidyverse</a>
    </li>
    <li>
      <a href="../articles/workflow.html">01 - Workflow with delayflow package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/modche/delayedflow/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find breakpoints in DFI curve</h1>
    <small class="dont-index">Source: <a href='https://github.com/modche/delayedflow/blob/master/R/find_bps.R'><code>R/find_bps.R</code></a></small>
    <div class="hidden name"><code>find_bps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimates n breakpoints in the DFI curve.
DFI values are compared against n+1 piecewise linear segments and the minimization of the
residuals (between linear segments and DFI curve). Several parameters can be customized.
If <code>q_obs</code> is given in daily temporal resolution then also <code>n</code> can be interpreted as delay in days
for different contributions (default).</p>
    </div>

    <pre class="usage"><span class='fu'>find_bps</span><span class='op'>(</span>
  <span class='va'>dfi</span>,
  n_bp <span class='op'>=</span> <span class='fl'>2</span>,
  bp_mingap <span class='op'>=</span> <span class='fl'>5</span>,
  bp_min <span class='op'>=</span> <span class='fl'>0</span>,
  bp_max <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>dfi</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span>,
  nmax <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>dfi</span><span class='op'>)</span>,
  of_weights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span><span class='op'>)</span>,
  desc <span class='op'>=</span> <span class='cn'>TRUE</span>,
  print <span class='op'>=</span> <span class='cn'>FALSE</span>,
  plotting <span class='op'>=</span> <span class='cn'>FALSE</span>,
  experimental <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dfi</th>
      <td><p>numeric, a vector with the DFI values between 1 and 0, dummy data <a href='dfi_example.html'>dfi_example</a> can be used.</p></td>
    </tr>
    <tr>
      <th>n_bp</th>
      <td><p>numeric, How many breakpoints (1, 2, 3) should be estimated (default = 2)? If <code>n_bp = 3</code>
calculation time could be longer if also <code>nmax</code> is high. <code>nmax</code> could be estimated with <a href='find_nmax.html'>find_nmax</a>.
For testing also <code>n_bp = 4</code> is possible See <code>experimental</code> setting.</p></td>
    </tr>
    <tr>
      <th>bp_mingap</th>
      <td><p>numeric, smallest interval between two breakpoints (default = 5).</p></td>
    </tr>
    <tr>
      <th>bp_min</th>
      <td><p>numeric, <code>bp_min</code>+1 is minimum allowed breakpoint position (default = 0).</p></td>
    </tr>
    <tr>
      <th>bp_max</th>
      <td><p>numeric, <code>bp_max</code>-1 is maximum allowed breakpoint position.</p></td>
    </tr>
    <tr>
      <th>nmax</th>
      <td><p>numeric parameter to truncate the tailing of the CDC (i.e. the length of <code>dfi</code> vector).
Note, <code>nmax</code> should not be confused with <code>bp_max</code> (i.e. maximum breakpoint position).</p></td>
    </tr>
    <tr>
      <th>of_weights</th>
      <td><p>vector with two elements, first is weight of the RMSE, second is weight of the MAE.
Default is c(0.5, 0.5), i.e. equal weights. Sum of vector must be 1. To switch of one measure use
<code><a href='https://rdrr.io/r/base/c.html'>c(1, 0)</a></code> or <code><a href='https://rdrr.io/r/base/c.html'>c(0,1)</a></code>. With the weighting more or less focus could be given to the upper parts
of the DFI curve (i.e. when block length <code>n</code> for separation is between 1 and 10).</p></td>
    </tr>
    <tr>
      <th>desc</th>
      <td><p>logical, if <code>TRUE</code> (recommended) DFI values are converted to be monotonically decreasing with <code><a href='https://rdrr.io/r/base/cumsum.html'>cummin()</a></code></p></td>
    </tr>
    <tr>
      <th>print</th>
      <td><p>logical, if <code>TRUE</code> best breakpoint estimates during calculation are printed (debug mode)</p></td>
    </tr>
    <tr>
      <th>plotting</th>
      <td><p>logical, if <code>TRUE</code> the DFI curve, piecewise linear segments and the breakpoints
are plotted with <code><a href='https://rdrr.io/r/graphics/plot.default.html'>plot()</a></code> whit DFI curve in blue and linear segments in red.</p></td>
    </tr>
    <tr>
      <th>experimental</th>
      <td><p>logical, if <code>TRUE</code> four breakpoints can be estimated.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a list with 3 elements.</p>
<dt>breakpoints</dt><dd><p>estimates for the n breakpoints with names <code>bp_n</code></p></dd>
<dt>bias</dt><dd><p>value of the objective function, default:
<code>OF = 1/2 RMSE + 1/2 MAE</code>,
where OF is to be minimized.</p></dd>
<dt>rel_contr</dt><dd><p>Relative streamflow contributions between <code>bp_min</code>, the breakpoints and <code>bp_max</code>,
e.g. 2 breakpoints lead to 3 relative contributions, 3 breakpoints lead to 4 relative contributions.
The first <code>rel_contr</code>-value is the fastest contribution to streamflow, the last <code>rel_contr</code>-value
is the slowest contribution to streamflow. All contributions add up to 1.</p></dd>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Stoelzle, M., Schuetz, T., Weiler, M., Stahl, K., &amp; Tallaksen, L. M. (2020). Beyond binary baseflow separation: a delayed-flow index for multiple streamflow contributions. Hydrology and Earth System Sciences, 24(2), 849-867.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># use dfi_example as an DFI vector with 121 values</span>
<span class='fu'>find_bps</span><span class='op'>(</span><span class='va'>dfi_example</span>, n_bp <span class='op'>=</span> <span class='fl'>3</span>, bp_max <span class='op'>=</span> <span class='fl'>90</span>, plotting <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Calculating breakpoints...Done. 
#&gt; </div><div class='img'><img src='find_bps-1.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; $bps_position
#&gt; bp_1 bp_2 bp_3 
#&gt;    4   18   60 
#&gt; 
#&gt; $bias
#&gt; [1] 0.01066672
#&gt; 
#&gt; $rel_contr
#&gt;   contr_1   contr_2   contr_3   contr_4 
#&gt; 0.3638711 0.2101886 0.2368266 0.1891137 
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michael Stoelzle.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


